var AppActionScriptsCreationsIndex=AppActionScriptsCreationsIndex||{};(function(f){function e(i,j){var k=i.getCursor();if(!j||j()){setTimeout(function(){if(!i.state.completionActive){i.showHint({completeSingle:false})}},100)}return CodeMirror.Pass}function d(i){return e(i,function(){var j=i.getCursor();return i.getRange(CodeMirror.Pos(j.line,j.ch-1),j)=="<"})}function a(i){return e(i,function(){var k=i.getTokenAt(i.getCursor());if(k.type=="string"&&(!/['"]/.test(k.string.charAt(k.string.length-1))||k.string.length==1)){return false}var j=CodeMirror.innerMode(i.getMode(),k.state).state;return j.tagName})}function b(){var j=f("#CreateType").val();if(!j){return""}var i=["package","profile","host","config","database","directory"];if(f.inArray(j,i)===-1){return""}return j}function c(j){if(!j){return""}var i="/files/JSON/"+j+".json";return i}function h(k){var l="";if(!k){return l}var j="/admin/creations/template";var i={data:{type:k}};f.ajax({url:j,async:false,method:"POST",data:i,dataType:"html",global:false,success:function(m){if(!m){return}l=m}});return l}function g(j){var i={};if(!j){return i}f.ajax({url:j,async:false,method:"GET",dataType:"json",global:false,success:function(k){if(!k){return}i=k}});return i}AppActionScriptsCreationsIndex.updateXmlInput=function(){if(typeof(CodeMirror)==="undefined"){return}var p=f("#CreateXml");if(p.length===0){return}var o=p.next(".CodeMirror");var i=p.data("sel-lines");var m=b();var l=c(m);var k=g(l);if(o.length){o.remove()}var j={lineNumbers:true,lineWrapping:true,mode:"xml",scrollbarStyle:"simple",matchTags:{bothTags:true},extraKeys:{"'<'":e,"'/'":d,"' '":a,"'='":a,"Ctrl-J":"toMatchingTag","Ctrl-Space":"autocomplete"},autoCloseBrackets:true,autoCloseTags:true,autoRefresh:true,hintOptions:{schemaInfo:k},theme:"eclipse"};var n=CodeMirror.fromTextArea(p.get(0),j);p.data("code-mirror",n);f.each(i,function(q,r){n.addLineClass(r-1,"background","mark")})};AppActionScriptsCreationsIndex.updateBtnClear=function(){f('.form-create-xml button[type="reset"]').off("click.AppActionScriptsCreationsIndex").on("click.AppActionScriptsCreationsIndex",function(n){n.stopPropagation();n.preventDefault();var m=f("#CreateXml");var i=m.data("code-mirror");var l=i.getDoc();var j=b();var k=h(j);l.setValue(k);l.clearHistory()})};AppActionScriptsCreationsIndex.updateSelectXmlType=function(){f("#CreateType").off("change.AppActionScriptsCreationsIndex").on("change.AppActionScriptsCreationsIndex",function(p){var o=f("#CreateXml");var i=o.data("code-mirror");var n=i.getDoc();var l=b();var k=c(l);var j=g(k);var m=h(l);i.setOption("hintOptions",{schemaInfo:j});n.setValue(m);n.clearHistory()})};AppActionScriptsCreationsIndex.updateFormSubmit=function(){f(".form-create-xml").off("submit.AppActionScriptsCreationsIndex").on("submit.AppActionScriptsCreationsIndex",function(m){var l=f("#CreateXml");var i=l.data("code-mirror");var k=i.getDoc();var j=k.getValue();if(f.trim(j).length===0){return false}return true})};return AppActionScriptsCreationsIndex})(jQuery);$(function(){$(document).off("MainAppScripts:update.AppActionScriptsCreationsIndex").on("MainAppScripts:update.AppActionScriptsCreationsIndex",function(){AppActionScriptsCreationsIndex.updateXmlInput();AppActionScriptsCreationsIndex.updateSelectXmlType();AppActionScriptsCreationsIndex.updateBtnClear();AppActionScriptsCreationsIndex.updateFormSubmit()})});